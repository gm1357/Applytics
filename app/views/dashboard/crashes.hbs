{{> _header}}

    <main role="main" class="container">
        <h1 class="text-center">Crashes</h1>

        <nav class="nav nav-pills nav-fill justify-content-around mt-5">
            <a class="nav-link" href="/dashboard">Dados gerais</a>
            <a class="nav-link active" href="/dashboard/crashes">Crashes</a>
            <a class="nav-link" href="/dashboard/usuarios">Usuarios</a>
        </nav>

        <hr>

        <div class="index shadow">
            <div class="row justify-content-around">
                <div class="col col-md-11">
                    <h2 class="text-center">Tabela de travamento do app</h2>

                    <table id="crashes" class="table table-striped responsive table-bordered" width="100%">
                        <thead>
                            <tr>
                                <th>ID usuário</th>
                                <th>Data</th>
                                <th>CPU</th>
                                <th>Ram atual</th>
                                <th>Ram total</th>
                                <th>Capacidade atual</th>
                                <th>Capacidade total</th>
                                <th>Bateria atual</th>
                                <th>Orientação da tela</th>
                                <th>Silenciado?</th>
                                <th>Processo de fundo?</th>
                                <th>Tratado?</th>
                                <th>Tempo de funcionamento</th>
                                <th>Stack-trace</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                        <tfoot>
                            <tr>
                                <th>ID usuário</th>
                                <th>Data</th>
                                <th>CPU</th>
                                <th>Ram atual</th>
                                <th>Ram total</th>
                                <th>Capacidade atual</th>
                                <th>Capacidade total</th>
                                <th>Bateria atual</th>
                                <th>Orientação da tela</th>
                                <th>Silenciado?</th>
                                <th>Processo de fundo?</th>
                                <th>Tratado?</th>
                                <th>Tempo de funcionamento</th>
                                <th>Stack-trace</th>
                            </tr>
                        </tfoot>
                    </table>

                    <br>

                    <div id="chartCrashes" style="width:100%; height:400px;"></div>
                </div>
            </div>
        </div>

        {{> _graficosCrashes}}
    </main>

    <script>
        $(document).ready(function() {
            $('#crashes').DataTable( {
                "language": {
                    "url": "//cdn.datatables.net/plug-ins/1.10.19/i18n/Portuguese-Brasil.json"
                },
                "data": {{{json crashes}}},
                responsive: {
                    details: {
                        display: $.fn.dataTable.Responsive.display.modal( {
                            header: function ( row ) {
                                var data = row.data();
                                return 'Detalhes do erro';
                            }
                        } ),
                        renderer: $.fn.dataTable.Responsive.renderer.tableAll( {
                            tableClass: 'table'
                        } )
                    }
                },
                columnDefs: [
                    { responsivePriority: 1, targets: 0 },
                    { responsivePriority: 2, targets: 1 },
                    { responsivePriority: 3, targets: -1 }
                ],
                "columns" : [
                    { "data" : "id_usuario" },
                    { 
                        "data" : "crashed_at",
                        "render": (data) => {
                            var date = new Date(data);
                            var month = date.getMonth() + 1;
                            return (date.getDate() >= 10 ? date.getDate() : "0" + date.getDate()) + "/" + (month >= 10 ? month : "0" + month) + "/" + date.getFullYear();
                        }    
                    },
                    { "data" : "cpu" },
                    { 
                        "data" : "ram_current",
                        "render": (data) => { return data + "Kb"; }
                    },
                    { 
                        "data" : "ram_total",
                        "render": (data) => { return data + "Kb"; }
                    },
                    { 
                        "data" : "disk_current",
                        "render": (data) => { return data + "Kb"; }
                    },
                    { 
                        "data" : "disk_total",
                        "render": (data) => { return data + "Kb"; }
                    },
                    { 
                        "data" : "bateria_current",
                        "render": (data) => { return data + "%"; }
                    },
                    { "data" : "orientacao" },
                    { 
                        "data" : "muted",
                        "render": (data) => { return (data ? "Sim" : "Não"); }
                    },
                    { 
                        "data" : "background",
                        "render": (data) => { return (data ? "Sim" : "Não"); }
                    },
                    { 
                        "data" : "nonfatal",
                        "render": (data) => { return (data ? "Sim" : "Não"); }
                    },
                    { 
                        "data" : "run_time",
                        "render": (data) => { return data + "s"; }
                    },
                    { "data" : "stack_trace" }
                ]
            });
        });
    </script>

{{> _footer}}